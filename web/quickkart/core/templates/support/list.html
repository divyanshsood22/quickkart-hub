{% extends "base.html" %}
{% block content %}

<h2 class="text-2xl font-bold mb-4">Support Tickets</h2>

<a href="/support/create/" class="bg-indigo-600 text-white px-4 py-2 rounded">
    Create Ticket
</a>

{% if tickets %}
<ul class="mt-4 space-y-3">
    {% for t in tickets %}
    <li class="bg-white p-4 rounded shadow">
        <p class="font-semibold">
            Ticket #{{ t.ticket_id }} â€” User: {{ t.user_id }}
        </p>

        <p class="mt-1 text-gray-700">
            {{ t.message }}
        </p>

        {% if t.last_reply %}
        <p class="mt-3 text-gray-800">
            <strong>{{ t.last_reply.role|capfirst }} replied:</strong>
            {{ t.last_reply.message }}
        </p>
        <p class="text-sm text-gray-500">
            {{ t.last_reply.time }}
        </p>
        {% else %}
        <p class="text-sm text-gray-500 mt-3 italic">
            No replies yet
        </p>
        {% endif %}


        <p class="mt-2 text-gray-600">
            Priority: {{ t.priority }} | Status: {{ t.status }}
        </p>

        <div class="mt-3">
            <a href="/support/{{ t.ticket_id }}/" class="text-indigo-600 underline">View</a>
            {% if t.status != "closed" %}
            <a href="/support/close/{{ t.ticket_id }}/" class="ml-3 text-red-600 underline">Close</a>
            {% endif %}
        </div>
    </li>

    {% endfor %}
</ul>
{% else %}
<p class="text-gray-600 mt-4">No tickets found.</p>
{% endif %}

{% endblock %}